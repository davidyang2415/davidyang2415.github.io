---
layout: post
title: server framework
categories:
- Programming Language
tags:
- Server Programming
---

#服务器架构
---

##服务器模型
- C/S模型
- P2P模型
	- 模型变种，是增加一个发现服务器

##服务器编程框架
- I/O处理单元
	- 单服务器：处理客户连接，读写网络数据
	- 服务器机群：接入服务器，实现负载均衡
- 请求队列
	- 单服务器：各单元之间的通信方式
	- 服务器机群：各服务器之间的永久TCP连接
- 逻辑单元
	- 单服务器：业务进程或线程
	- 服务器机群：逻辑服务器
- 网络存储单元
	- 单服务器：本地数据库、文件或缓存
	- 服务器机群：数据库服务器

##I/O模型
- 阻塞I/O与非阻塞I/O：
	- 阻塞I/O会因为无法立即完成而被系统挂起来等待事件的发生或完成
	- 非阻塞I/O的调用会立即返回，而不管事件是否已经发生。
		- 没有立即发生时的返回值是-1，根据errno进行不同行为的区分：
		- 对accept,send和recv而言，事件未发生时errno设置为EAGAIN(再来一次)或EWOULDBLOCK(期待阻塞)
		- 对connect而言，事件未发生时errno设置为EINPROGRESS(在处理中)
- 为提供程序效率，将非阻塞I/O和其他I/O通知机制一起使用
	- I/O通知机制包括：I/O复用和SIGIO信号
		- I/O复用，监听多个I/O事件，但I/O复用调用本身是阻塞的
		- SIGIO信号，信号触发读写就绪事件
- 同步I/O模型与异步I/O模型：
	- 同步I/O模型，要求用户代码自行执行I/O操作
	- 异步I/O模型，由内核来执行I/O操作，通知用户代码事件完成--参考windows平台的完成端口(IOCP)概念

##事件处理模式
- 服务器通常需要处理的三类事件：I/O事件、信号及定时事件
- Reactor模式、Proactor模式及模拟Proactor模式
	- Reactor模式：
		- 一般使用同步I/O模型实现，主线程只负责监听文件描述符上的事件触发及通知工作线程，本身不做实质性的工作
	- Proactor模式：
		- 一般使用异步I/O模型实现，主线程及内核负责所有I/O操作，而工作线程仅负责业务逻辑
	- 模拟Proactor模式：
		- 使用同步I/O模型模拟实现，因为没有内核的支持，主线程负责所有的I/O操作即为模拟

##并发模式
- 并发模式适用于I/O密集型程序
- 两种并发模式：半同步/半异步模式、领导者/追随者模式
	- 半同步/半异步模式
		- 同步--按代码顺序执行，异步--由系统事件驱动程序的执行
	- 领导者/追随者模式 